<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Journey Details Banner -->
    <div class="mb-8 bg-red-600 rounded-lg p-5 shadow text-white">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Route -->
            <div class="flex items-center gap-3">
                <lucide-icon [img]="MapPin" class="text-white" [size]="20"></lucide-icon>
                <div>
                    <p class="text-xs text-red-100">Route</p>
                    <p class="text-base font-semibold">{{ journey.from }} → {{ journey.to }}</p>
                </div>
            </div>
            <!-- Timing -->
            <div class="flex items-center gap-3">
                <lucide-icon [img]="Clock" class="text-white" [size]="20"></lucide-icon>
                <div>
                    <p class="text-xs text-red-100">Departure - Arrival</p>
                    <p class="text-base font-semibold">{{ journey.departureTime }} - {{ journey.arrivalTime }}</p>
                </div>
            </div>
            <!-- Bus Info -->
            <div class="flex items-center gap-3">
                <lucide-icon [img]="Info" class="text-white" [size]="20"></lucide-icon>
                <div>
                    <p class="text-xs text-red-100">Bus Details</p>
                    <p class="text-base font-semibold">{{ journey.busType }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-slate-800 mb-1">Select Your Seats</h1>
        <p class="text-slate-600">Choose your preferred seats and complete your booking</p>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- LEFT: Booking Form -->
        <div class="lg:col-span-1 order-2 lg:order-1">
            <div class="bg-white rounded-lg p-6 shadow border border-slate-200 sticky top-4">
                <h2 class="text-lg font-semibold text-slate-800 mb-6">Booking Details</h2>
                <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()" class="space-y-5">
                    <!-- Travel Date -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            <div class="flex items-center gap-2">
                                <lucide-icon [img]="Calendar" [size]="16" class="text-slate-500"></lucide-icon>
                                <span>Travel Date</span>
                                <span class="text-red-600">*</span>
                            </div>
                        </label>
                        <p-datepicker formControlName="travelDate" styleClass="w-full" [minDate]="today"
                            placeholder="Select travel date" dateFormat="dd/mm/yy" [showButtonBar]="true" />
                    </div>

                    <!-- Mobile Number -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            <div class="flex items-center gap-2">
                                <lucide-icon [img]="Phone" [size]="16" class="text-slate-500"></lucide-icon>
                                <span>Mobile Number</span>
                                <span class="text-red-600">*</span>
                            </div>
                        </label>
                        <div class="flex items-stretch gap-2">
                            <span
                                class="text-sm font-medium text-slate-700 px-3 py-2 bg-slate-50 rounded border border-slate-300 flex items-center">+91</span>
                            <input pInputText formControlName="mobileNumber" type="tel"
                                placeholder="Enter 10-digit mobile" class="flex-1" maxlength="10" />
                        </div>
                        <small
                            *ngIf="bookingForm.get('mobileNumber')?.invalid && bookingForm.get('mobileNumber')?.touched"
                            class="text-red-600 text-xs mt-1 block">
                            Enter valid 10-digit mobile number
                        </small>
                    </div>

                    <!-- Selected Seats Info -->
                    <div class="pt-4 border-t border-slate-200">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm font-medium text-slate-700">Selected Seats</span>
                            <span [class]="seatCountClass + ' text-sm font-semibold'">{{ selectedSeats.length }} /
                                6</span>
                        </div>

                        <div *ngIf="selectedSeats.length > 0" class="mb-3 flex flex-wrap gap-2">
                            <span *ngFor="let seat of selectedSeats"
                                class="px-2.5 py-1 bg-red-50 text-red-700 rounded text-xs font-medium border border-red-200">{{
                                seat }}</span>
                        </div>

                        <div *ngIf="selectedSeats.length === 0"
                            class="text-center py-4 bg-slate-50 rounded border border-slate-200">
                            <p class="text-sm text-slate-500">No seats selected</p>
                        </div>
                        <div class="text-xs text-slate-500 mt-2">Maximum 6 seats per booking</div>
                    </div>

                    <!-- Total Price -->
                    <div *ngIf="selectedSeats.length > 0" class="pt-2 pb-2">
                        <div class="flex justify-between items-center text-slate-800 font-bold">
                            <span>Total Fare</span>
                            <span>₹{{ totalPrice }}</span>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-2">
                        <p-button type="submit" label="Confirm Booking" icon="pi pi-check"
                            styleClass="w-full btbs-custom-btn" [disabled]="!isFormValid" [loading]="loading" />
                    </div>
                </form>
            </div>
        </div>

        <!-- RIGHT: Seat Grid -->
        <div class="lg:col-span-2 order-1 lg:order-2">
            <div class="bg-white rounded-lg p-6 shadow border border-slate-200">
                <!-- Bus Front -->
                <div class="mb-6 text-center">
                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-red-50 rounded border border-red-200">
                        <lucide-icon [img]="ArrowUp" class="text-red-600" [size]="16"></lucide-icon>
                        <span class="text-xs font-semibold text-red-700 uppercase">Front</span>
                    </div>
                </div>

                <!-- Grid -->
                <div class="space-y-3 mb-6">
                    <div *ngFor="let row of rows" class="flex items-center gap-4 justify-center">
                        <div class="w-8 text-center"><span class="text-xs font-semibold text-slate-600">{{ row }}</span>
                        </div>

                        <!-- Left Seats -->
                        <div class="flex gap-2">
                            <button *ngFor="let seat of ['A'+row, 'B'+row]" (click)="onSeatClick(seat)"
                                [disabled]="isSeatBooked(seat)" [class]="getSeatClasses(seat)"
                                [title]="getSeatTooltip(seat)">
                                <span class="text-xs font-semibold">{{ seat }}</span>
                                <span *ngIf="!isSeatBooked(seat) && !isSeatSelected(seat)"
                                    class="text-[9px] text-slate-500 mt-0.5">₹{{ getSeatPrice(seat) }}</span>
                                <span *ngIf="isSeatSelected(seat)" class="text-[10px] text-white mt-0.5">✓</span>
                                <!-- Window Indicator -->
                                <div *ngIf="getSeatType(seat) === 'window' && !isSeatBooked(seat)"
                                    class="absolute -right-0.5 top-1/2 -translate-y-1/2 w-0.5 h-6 bg-red-500"></div>
                            </button>
                        </div>

                        <!-- Aisle -->
                        <div class="w-8 border-l border-r border-dashed border-slate-300 h-14"></div>

                        <!-- Right Seats -->
                        <div class="flex gap-2">
                            <button *ngFor="let seat of ['C'+row, 'D'+row]" (click)="onSeatClick(seat)"
                                [disabled]="isSeatBooked(seat)" [class]="getSeatClasses(seat)"
                                [title]="getSeatTooltip(seat)">
                                <span class="text-xs font-semibold">{{ seat }}</span>
                                <span *ngIf="!isSeatBooked(seat) && !isSeatSelected(seat)"
                                    class="text-[9px] text-slate-500 mt-0.5">₹{{ getSeatPrice(seat) }}</span>
                                <span *ngIf="isSeatSelected(seat)" class="text-[10px] text-white mt-0.5">✓</span>
                                <div *ngIf="getSeatType(seat) === 'window' && !isSeatBooked(seat)"
                                    class="absolute -right-0.5 top-1/2 -translate-y-1/2 w-0.5 h-6 bg-red-500"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="pt-4 border-t border-slate-200">
                    <div class="grid grid-cols-2 gap-3 text-xs">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-10 rounded bg-white border border-slate-300"></div>
                            <div>
                                <div class="font-medium text-slate-700">Available</div>
                                <div class="text-slate-500">₹{{ baseSeatPrice }}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="relative w-8 h-10 rounded bg-white border border-red-400">
                                <div class="absolute -right-0.5 top-1/2 -translate-y-1/2 w-0.5 h-6 bg-red-500"></div>
                            </div>
                            <div>
                                <div class="font-medium text-slate-700">Window</div>
                                <div class="text-red-600">₹{{ baseSeatPrice + windowSeatSurcharge }}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-10 rounded bg-red-600 border border-red-700"></div>
                            <div class="font-medium text-slate-700">Selected</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-10 rounded bg-slate-300 border border-slate-400"></div>
                            <div class="font-medium text-slate-700">Booked</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <p-dialog [(visible)]="showConfirmation" [modal]="true" [closable]="true" [style]="{ width: '500px' }"
        [draggable]="false" [resizable]="false" (onHide)="onBookAnother()" styleClass="confirmation-dialog">
        <ng-template pTemplate="header">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center">
                    <lucide-icon [img]="CheckCircle" class="text-emerald-600" [size]="24"></lucide-icon>
                </div>
                <h3 class="text-xl font-bold text-slate-800">Booking Confirmed!</h3>
            </div>
        </ng-template>

        <div class="py-4 px-2" *ngIf="confirmedBooking">
            <p class="text-slate-600 mb-6 text-center text-lg">Your journey is confirmed! Here are your ticket details.
            </p>
            <div class="ticket-container">
                <div class="ticket-header">
                    <div>
                        <span class="ticket-label block">Booking ID</span>
                        <span class="font-mono font-bold text-slate-800 text-lg">{{ confirmedBooking.id }}</span>
                    </div>
                    <lucide-icon [img]="CheckCircle" class="text-emerald-500 opacity-20" [size]="48"></lucide-icon>
                </div>
                <div class="ticket-body">
                    <div class="ticket-row border-b border-slate-100 pb-3 mb-3">
                        <span class="ticket-label">Travel Date</span>
                        <span class="ticket-value">{{ confirmedBooking.travelDate | date:'fullDate' }}</span>
                    </div>
                    <div class="ticket-row border-b border-slate-100 pb-3 mb-3">
                        <span class="ticket-label">Mobile Number</span>
                        <span class="ticket-value">+91 {{ confirmedBooking.mobileNumber }}</span>
                    </div>
                    <div class="mb-4">
                        <span class="ticket-label block mb-2">Selected Seats</span>
                        <div class="flex flex-wrap gap-2">
                            <span *ngFor="let seat of confirmedBooking.seats"
                                class="px-3 py-1 bg-red-50 text-red-600 border border-red-100 rounded text-sm font-bold shadow-sm">{{
                                seat }}</span>
                        </div>
                    </div>
                    <div *ngIf="confirmedBooking.totalAmount"
                        class="ticket-row bg-slate-50 -mx-6 -mb-6 px-6 py-4 mt-4 border-t border-slate-100 flex justify-between items-center">
                        <span class="ticket-label text-slate-700">Total Amount</span>
                        <span class="ticket-value text-xl">₹{{ confirmedBooking.totalAmount }}</span>
                    </div>
                </div>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="flex gap-3">
                <p-button label="Book Another" icon="pi pi-plus" (onClick)="onBookAnother()"
                    styleClass="flex-1 btbs-custom-modal-btn w-full" [outlined]="true" />
                <p-button label="Close" icon="pi pi-times" (onClick)="showConfirmation = false"
                    styleClass="flex-1 btbs-custom-modal-btn w-full" />
            </div>
        </ng-template>
    </p-dialog>
</div>